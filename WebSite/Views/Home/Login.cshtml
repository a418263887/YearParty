@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <title>新云报登录</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" lang="zh-cn" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- basic styles -->
    <link href="~/Plugin/bootstrap3.3.5/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Plugin/font/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/Content/css/ace.min.css" rel="stylesheet" />


    <!--[if lt IE 9]>
    <script src="~/plugin/assets/js/html5shiv.js"></script>
    <script src="~/plugin/assets/js/respond.min.js"></script>
    <![endif]-->
    @*<script>
        var oaapi = '@Html.Raw(ViewBag.oaapi)';
        location.href = oaapi + '/user/auth?channel=1001&redirect=' + location.origin + '/home/AuthBack'
    </script>*@
</head>

<body class="login-layout">
    <div class="main-container">
        <div class="main-content">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="login-container">
                        <div class="center">
                            <h1>
                                <i class="icon-leaf green"></i>
                                <span class="red">登录</span>
                                <span class="white"></span>
                            </h1>
                            <h4 class="blue">&copy; 逸鸣惊人晚会</h4>
                        </div>

                        <div class="space-6"></div>

                        <div class="position-relative">
                            <div id="login-box" class="login-box visible widget-box no-border">
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <h4 class="header blue lighter bigger">
                                            <i class="icon-coffee green"></i>
                                            请输入工号
                                        </h4>

                                        <div class="space-6"></div>
                                        <div style="height:20px;margin-bottom:5px">
                                            <span id="login-info" style="display:none;color:orange">工号错误或者无效</span>
                                        </div>
                                        <form>
                                            <fieldset>
                                                <label class="block clearfix">
                                                    <span class="block input-icon input-icon-right">
                                                        <input type="text" id="login-uid" class="form-control" placeholder="工号" />
                                                        <i class="icon-user"></i>
                                                    </span>
                                                </label>

                                                @*<label class="block clearfix">
                                                    <span class="block input-icon input-icon-right">
                                                        <input type="password" id="login-pwd" class="form-control" placeholder="密码" />
                                                        <i class="icon-lock"></i>
                                                    </span>

                                                </label>*@


                                                @*@if (true)
                                                {
                                                    <label class="block clearfix loginimgcode">

                                                        <input type="text" id="login-code" placeholder="验证码" class="form-control" style="display:inline-block;width:218px" />
                                                        <img alt="图像验证码" style="max-width: 100%; max-height: 34px; margin-top: -3px;"
                                                             src="@Url.Action("ImageCode")" class="imageholder">
                                                    </label>
                                                }*@



                                                <div class="space"></div>

                                                <div class="clearfix">
                                                    @*<label class="inline">
                                                        <input type="checkbox" id="ck_rmbUser" class="ace" />
                                                        <span class="lbl"> 记住我</span>
                                                    </label>*@

                                                    <button type="button" id="btn-login" class="width-35 pull-right btn btn-sm btn-primary">
                                                        <i class="icon-key"></i>
                                                        登陆
                                                    </button>
                                                </div>

                                                <div class="space-4"></div>
                                            </fieldset>
                                        </form>

                                        @*<div class="social-or-login center">
                                            <span class="bigger-110">其他方式登陆</span>
                                        </div>

                                        <div class="social-login center">
                                            <label>暂未开通</label>

                                        </div>*@
                                    </div><!-- /widget-main -->

                                    <div class="toolbar clearfix">

                                    </div>
                                </div><!-- /widget-body -->
                            </div><!-- /login-box -->



                        </div><!-- /position-relative -->
                    </div>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div>
    </div><!-- /.main-container -->
    <!-- basic scripts -->
    <!--[if !IE]> -->


    <script src="~/Plugin/jquery/jquery-1.9.1.min.js"></script>
    <script src="~/Plugin/layui/layui.all.js"></script>


    <script type="text/javascript">
        if ("ontouchend" in document) document.write("<script src='/Plugin/jquery/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>

    <!-- inline scripts related to this page -->

    <script type="text/javascript">
        function show_box(id) {
            jQuery('.widget-box.visible').removeClass('visible');
            jQuery('#' + id).addClass('visible');
        }
    </script>


    <script>



        //获取url中的参数
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg); //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }

        $(function () {

            var imgUrl = '@Url.Action("ImageCode")'
            $(".imageholder").click(function () {

                $(this).attr("src", imgUrl + "?t=" + new Date().getTime());
            })

            $(document).keydown(function (e) {
                if (e.keyCode == 13) {
                    $("#btn-login").click();
                }
            })
            $("#btn-login").click(function () {

                var userid = $("#login-uid").val();
                if (userid == "") {
                    $("#login-info").text("工号不能为空");
                    $("#login-info").show();
                    return false;
                }
              
                layer.load("验证中...");
                $.post('@Url.Action("ajaxlogin","home")', { uid: userid}, function (data) {
                    layer.closeAll();
                    if (data.Code == 1) {


                        layer.load("跳转中...");
                        $("#login-info").hide();

                        var redirect = getUrlParam("RedirectUrl");

                        if (redirect != null && redirect.length>0) {
                            location.href = redirect;
                        } else {
                            location.href = '@Url.Action("index", "home")';
                        }
                    } else {

                        if (data.Code == -1 && codeDiv.length <= 0) {

                            location = location;
                        }

                        $("#login-info").text(data.Msg);
                        $("#login-info").show();
                    }
                }, "json").error(function () {
                    location = location;
                    //layer.closeAll();
                    //$("#login-info").text("网络异常");
                    //$("#login-info").show();
                })
            })

        })
        //方式一
        if (self.frameElement && self.frameElement.tagName == "IFRAME") {
            window.parent.location.href = '@Url.Action("login", "home")';
        }

    </script>
    <script src="~/Content/md5.js"></script>
    <script src="~/Plugin/jquery/jquery.cookie.js"></script>

</body>
</html>
